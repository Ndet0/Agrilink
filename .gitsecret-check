# GitGuardian Secret Detection Prevention

This file documents how to prevent secrets from being committed to the repository.

## âœ… Files Protected

The following files are in `.gitignore` to prevent accidental secret commits:
- `.env` - All environment files
- `*.env` - All .env variants
- `server/.env` - Backend environment
- `client/.env` - Frontend environment

**Exception**: `.env.example` files ARE committed (with placeholders only)

## âš ï¸ NEVER Commit These

1. **Environment Files** (`.env`)
   - Contains SECRET_KEY, database passwords, API keys
   - Always use `.env.example` as template

2. **Configuration with Secrets**
   - Database connection strings with passwords
   - API keys and tokens
   - OAuth client secrets
   - Private keys or certificates

3. **Development Files**
   - `*.log` files may contain sensitive data
   - Database dumps (`.sql`, `.dump`)
   - Session files

## âœ… Safe to Commit

1. **Example Files**
   - `.env.example` - MUST use placeholders only
   - `config.example.js` - Template configurations
   - Documentation files

2. **Public Configuration**
   - `requirements.txt` - Dependency lists
   - `package.json` - NPM dependencies
   - Docker configs (without secrets)

## ðŸ” Secret Management Best Practices

### For .env.example Files

**âŒ WRONG** - Never use real values:
```bash
SECRET_KEY=f389a0241b0eece52ee4f8d40bda4354ff081080735b2312c20d5c7ab02f61dc
DATABASE_URL=postgresql://admin:MyP@ssw0rd@localhost/agrilink
```

**âœ… CORRECT** - Use clear placeholders:
```bash
SECRET_KEY=your-secret-key-here-replace-with-generated-value-min-32-chars
DATABASE_URL=postgresql://username:password@host:port/database_name
```

### Generating Secrets

```bash
# Generate SECRET_KEY (64 characters recommended)
python -c 'import secrets; print(secrets.token_hex(32))'

# Generate API tokens
python -c 'import secrets; print(secrets.token_urlsafe(32))'

# Generate passwords
python -c 'import secrets, string; chars=string.ascii_letters+string.digits+string.punctuation; print("".join(secrets.choice(chars) for _ in range(20)))'
```

### Before Committing

Always run these checks:

```bash
# Check for .env files
git status | grep "\.env$"

# Search for potential secrets in staged files
git diff --cached | grep -i "secret\|password\|api_key\|token"

# Check what's being committed
git diff --cached
```

## ðŸš¨ If You Accidentally Commit a Secret

1. **DO NOT** just delete it in a new commit - it's still in history!
2. **Immediately rotate** the compromised secret
3. **Remove from Git history**:
   ```bash
   # For recent commits (not pushed)
   git reset --soft HEAD~1

   # For pushed commits - contact admin immediately
   # May require git filter-branch or BFG Repo-Cleaner
   ```

## GitGuardian Integration

This repository uses GitGuardian to scan for secrets:
- Scans pull requests automatically
- Detects 350+ types of secrets
- Alerts on hardcoded credentials

### Common False Positives

- Example files with placeholder values (like `.env.example`)
- Test fixtures with dummy data
- Public API keys for development services

### Handling Alerts

1. **True Positive** (real secret):
   - Rotate the secret immediately
   - Remove from repository history
   - Update all environments

2. **False Positive** (placeholder):
   - Make placeholder more obvious
   - Add comment indicating it's an example
   - Document in this file

## Environment Setup for Developers

```bash
# 1. Copy example files
cp server/.env.example server/.env
cp client/.env.example client/.env

# 2. Generate secrets
export SECRET_KEY=$(python -c 'import secrets; print(secrets.token_hex(32))')

# 3. Update .env files with real values
echo "SECRET_KEY=$SECRET_KEY" >> server/.env

# 4. NEVER commit .env files
git status  # Should not show .env files
```

## Additional Resources

- [GitGuardian Documentation](https://docs.gitguardian.com/)
- [OWASP Secrets Management Cheat Sheet](https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html)
- [12 Factor App - Config](https://12factor.net/config)
